"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.string.includes.js");var _react=require("react"),_unstatedNext=require("unstated-next"),_utils=require("./libs/utils"),_constants=require("./constants");const useCascade=a=>{const{options:b,value:c,selectAll:d,onChange:e,onCascaderChange:f,selectLeafOnly:g}=a||{},[h,i]=(0,_react.useState)(!1),j=(0,_react.useRef)(b);(0,_react.useEffect)(()=>{j.current=b},[b]);const[k,l]=(0,_react.useState)(()=>d?(0,_utils.flattenTree)([{text:"All",value:_constants.All,parent:null,children:b}]):(0,_utils.flattenTree)(b||[]));(0,_react.useEffect)(()=>{l(()=>d?(0,_utils.flattenTree)([{text:"All",value:_constants.All,parent:null,children:b}]):(0,_utils.flattenTree)(b||[]))},[b,d]);const m=(0,_react.useCallback)(a=>{const b=(0,_utils.transformValue)(a,k);return e&&!(0,_utils.shallowEqualArray)(b,a)&&requestAnimationFrame(()=>v(b)),b},[k]),[n,o]=(0,_react.useState)(()=>{var a;return d&&1===k.length?[]:[d?null===(a=k[0])||void 0===a?void 0:a.children:k.filter(a=>!a.parent)]}),[p,q]=(0,_react.useState)([]),[r,s]=(0,_react.useState)(m(c||[])),t=(0,_react.useRef)(r),u=(0,_react.useMemo)(()=>k.filter(a=>(c||t.current).includes(a.value)),[k,c,h,t.current]),v=(0,_react.useCallback)(a=>{e&&e(a,u.slice(0)),t.current=a,s(a),i(!1)},[u]),w=(0,_react.useCallback)((a,b)=>{a&&a.length?o(c=>[...c.slice(0,b),a]):o(a=>[...a.slice(0,b)])},[]),x=(0,_react.useCallback)((a,b)=>{const c=(0,_utils.findNodeByValue)(a.value,null===j||void 0===j?void 0:j.current);return c&&(c.children=b),[...(null===j||void 0===j?void 0:j.current)]},[]),y=(0,_react.useRef)(null),z=(0,_react.useCallback)((a,b)=>{const{children:c}=a;y.current=a,null===f||void 0===f?void 0:f(a,{add:c=>{const d=x(a,c);return y.current===a&&(a.children=c,c.forEach(b=>{b.parent=a}),l(a=>[...a,...c]),z(a,b)),d}}),w(c,b+1),q(c=>c.slice(0,b).concat(a))},[p,f]),A=(0,_react.useCallback)((a,b)=>{s(c=>(0,_utils.sortByTree)((0,_utils.reconcile)(a,b,c),k))},[k]),B=(0,_react.useCallback)(()=>{if(d&&1===k.length)return o([]);var a;o([d?null===(a=k[0])||void 0===a?void 0:a.children:k.filter(a=>!a.parent)]),q([])},[k,d]);return(0,_react.useEffect)(()=>{h&&(s(m(c||t.current)),B())},[h]),{menuPath:p,popupVisible:h,setPopupVisible:i,menuData:n,addMenu:w,setMenuData:o,value:r,setValue:s,handleCascaderChange:z,handleSelectChange:A,flattenData:k,resetMenuState:B,selectedItems:u,triggerChange:v,selectLeafOnly:g,hackValue:t}};var _default=(0,_unstatedNext.createContainer)(useCascade);exports.default=_default;